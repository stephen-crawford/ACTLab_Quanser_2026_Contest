=== Full Mission Closed-Loop Simulation ===

Running hub_to_pickup...
  hub_to_pickup: max_cte=0.021 avg_cte=0.006 steps=272 prog=99% heading_err_max=8.3deg steer_sat=0 completed=yes
Running pickup_to_dropoff...
    Hermite blend: heading_err=-89.9deg, blend_dist=2.50m, chord=2.27m
  pickup_to_dropoff: max_cte=0.018 avg_cte=0.008 steps=172 prog=99% heading_err_max=7.6deg steer_sat=0 completed=yes
Running dropoff_to_hub...
    Hermite blend: heading_err=94.5deg, blend_dist=2.50m, chord=2.14m
  dropoff_to_hub: max_cte=0.030 avg_cte=0.009 steps=400 prog=99% heading_err_max=11.0deg steer_sat=0 completed=yes
Blended path: blended_hub_to_pickup.csv (2103 points)
Blended path: blended_pickup_to_dropoff.csv (1225 points)
Blended path: blended_dropoff_to_hub.csv (2836 points)

CSV written: full_mission_sim.csv (844 data points)

=== Mission Summary ===
Duration: 86.3s
Max CTE:  0.030m
Avg CTE:  0.008m
Avg speed: 0.36 m/s
Points:   844

PASS: Max CTE 0.030m within 0.30m threshold


=== Full Mission with Traffic Events ===

Running hub_to_pickup (with traffic)...
    [hub_to_pickup] 2 traffic stops, creep=off, max_cte=0.021
  hub_to_pickup: max_cte=0.021 avg_cte=0.005 steps=363 prog=99% heading_err_max=8.3deg steer_sat=0 completed=yes
Running pickup_to_dropoff (with traffic)...
    Hermite blend: heading_err=-89.9deg, blend_dist=2.50m, chord=2.27m
    [pickup_to_dropoff] 0 traffic stops, creep=off, max_cte=0.018
  pickup_to_dropoff: max_cte=0.018 avg_cte=0.008 steps=185 prog=98% heading_err_max=7.6deg steer_sat=0 completed=yes
Running dropoff_to_hub (with traffic)...
    Hermite blend: heading_err=95.0deg, blend_dist=2.50m, chord=2.15m
    [dropoff_to_hub] 2 traffic stops, creep=off, max_cte=0.031
  dropoff_to_hub: max_cte=0.031 avg_cte=0.008 steps=544 prog=99% heading_err_max=11.0deg steer_sat=0 completed=yes

=== Traffic Mission Summary ===
Duration: 111.1s
Max CTE:  0.031m
Avg CTE:  0.007m
Points:   1092

PASS: Traffic test Max CTE 0.031m within 0.30m


=== Stress Test: Frequent Stops ===

    [stress_hub_to_pickup] 9 traffic stops, creep=off, max_cte=0.020
  Stress test: max_cte=0.020 avg_cte=0.005 steps=502 prog=99% completed=yes
PASS: Stress test Max CTE 0.020m within 0.30m


=== Sim-to-Real Gap Analysis ===

[Gap Test 4a] boundary_weight=8.0 (deployment had this, ref has 0)
    Hermite blend: heading_err=-89.8deg, blend_dist=2.50m, chord=2.29m
    Hermite blend: heading_err=94.9deg, blend_dist=2.50m, chord=2.15m
  boundary_weight=8.0: max_cte=0.030m (vs 0.067m without boundaries)

[Gap Test 4b] Velocity estimation lag (EKF ~100ms delay)
    Hermite blend: heading_err=-89.9deg, blend_dist=2.50m, chord=2.27m
    Hermite blend: heading_err=94.5deg, blend_dist=2.50m, chord=2.14m
  velocity_lag=100ms: max_cte=0.030m (vs 0.067m without lag)

[Gap Test 4c] boundary_weight=8.0 + velocity_lag=100ms (full deployment model)
    Hermite blend: heading_err=-89.8deg, blend_dist=2.50m, chord=2.29m
    Hermite blend: heading_err=94.9deg, blend_dist=2.50m, chord=2.15m
  boundary+lag combined: max_cte=0.030m (deployment saw 0.203m)

[Gap Test 4d] Position noise σ=10mm + heading noise σ=2° (SLAM jitter)
    Hermite blend: heading_err=-89.4deg, blend_dist=2.50m, chord=2.28m
    Hermite blend: heading_err=94.6deg, blend_dist=2.50m, chord=2.15m
  noise σ_pos=10mm σ_θ=2°: max_cte=0.028m avg_cte=0.009m

[Gap Test 4e] ALL: boundary=8.0 + vel_lag + noise σ=10mm/2°
    Hermite blend: heading_err=-89.4deg, blend_dist=2.50m, chord=2.28m
    Hermite blend: heading_err=94.7deg, blend_dist=2.50m, chord=2.14m
  ALL combined: max_cte=0.028m avg_cte=0.010m (deployment saw max=0.203 avg=0.090)

=== Gap analysis complete ===
Fix applied: boundary_weight=0, use_state_estimator=false

=== ALL TESTS PASSED ===
