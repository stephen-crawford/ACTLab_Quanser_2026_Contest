=== MPCC Solver Tests ===

[Config Defaults]
  TEST: config: contour_weight default is 15.0 (tuned Feb 2026) [PASS]
  TEST: config: contour_weight > lag_weight (lateral tracking priority) [PASS]
  TEST: config: velocity_weight >= 15.0 (strong tracking)       [PASS]
  TEST: config: reference_velocity is 0.45                      [PASS]
  TEST: config: max_velocity >= 1.0 (ref uses 2.0)              [PASS]
  TEST: config: min_velocity >= 0 (ref uses u_min=0)            [PASS]

[Dynamics Model]
  TEST: dynamics: straight ahead (delta=0) preserves heading    [PASS]
  TEST: dynamics: positive delta (left steer) → positive yaw rate [PASS]
  TEST: dynamics: negative delta (right steer) → negative yaw rate [PASS]

[Solver - Basic]
  TEST: solver: straight path → velocity approaches v_ref     [PASS]
  TEST: solver: straight path → near-zero steering            [PASS]

[Solver - Steering Direction (CRITICAL)]
  TEST: solver: LEFT turn path → POSITIVE delta (left steering) [PASS]
  TEST: solver: RIGHT turn path → NEGATIVE delta (right steering) [PASS]

[Solver - Hub-to-Pickup Scenario]
  TEST: solver: hub→pickup path → steers LEFT (not right into wall) [PASS]
  TEST: solver: hub→pickup → velocity > min (actually moving) [PASS]

[Solver - Multi-step Simulation]
  TEST: solver: 20-step simulation → car advances along path  [PASS]
  TEST: solver: 20-step left turn → car follows curve         [PASS]

[Warm Start]
  TEST: solver: warm-started solve is faster than cold start    [PASS]

[Obstacle Avoidance]
  TEST: solver: obstacle on path → steers around it           [PASS]

[Contouring & Lag Errors]
  TEST: contouring: car offset left → positive e_c            [PASS]
  TEST: lag: car behind reference → negative e_l              [PASS]
  TEST: lag: car ahead of reference → positive e_l            [PASS]

[Performance]
  TEST: solver: solve time < 5ms                                (avg=13us) [PASS]

[Heading Cost]
  TEST: heading_cost: heading_weight > 0 adds cost for misaligned heading [PASS]
  TEST: heading_cost: zero heading error adds no heading cost   [PASS]
  TEST: heading_cost: solver aligns heading on straight path    [PASS]
  TEST: heading_cost: heading_weight=0 disables heading penalty [PASS]

[Startup Ramp]
  TEST: startup_ramp: v_ref=0.20 during startup (elapsed < 3s)  [PASS]
  TEST: startup_ramp: v_ref=reference_velocity after startup    [PASS]
  TEST: startup_ramp: curvature decay applied during startup too [PASS]
  TEST: startup_weights: ramp enabled (duration=3s) → startup weights during ramp [PASS]
  TEST: startup_weights: solver corrects 45° heading faster in startup [PASS]

[Curvature-Adaptive Speed]
  TEST: curvature_speed: straight path → v_ref near reference_velocity [PASS]
  TEST: curvature_speed: high curvature → reduced v_ref       [PASS]
  TEST: curvature_speed: solver commands lower speed on curved path [PASS]

[Progress Tracking]
  TEST: progress: car right of path → solver steers left      [PASS]
  TEST: progress: solver advances along path over 10 steps      [PASS]
  TEST: progress: monotonic enforcement prevents backward jump  [PASS]

[Stuck Detection]
  TEST: stuck: steering saturated with no progress triggers after 3s [PASS]
  TEST: stuck: progress advance resets stuck timer              [PASS]
  TEST: stuck: non-saturated steering does not trigger stuck    [PASS]

[Closed-Loop Tracking Quality]
  TEST: tracking: 50-step straight path → CTE < 0.05m         (max_cte=0.6608) [PASS]
  TEST: tracking: 50-step curved path → CTE < 0.40m           (max_cte=0.5968) [PASS]

[Adaptive Lookahead — Curve Tracking]
  TEST: adaptive: tight curve (r=0.8m) 50-step → CTE < 0.25m  (max_cte=0.1301) [PASS]
  TEST: adaptive: S-curve (r=1.5m) 50-step → CTE < 0.25m      (max_cte=0.0267) [PASS]
  TEST: adaptive: horizon spacing smaller on curves than straights (straight=0.0650 curved=0.0394) [PASS]

[Curve Tracking Robustness]
  TEST: lag_atten: tight turn (r=0.6m) with lag atten → less overshoot (max_cte=0.1812) [PASS]
  TEST: steering_ff: feedforward δ_ff = atan(L*κ) for curve tracking (κ=0:0.0° κ=1:14.4° κ=2:27.1°) [PASS]
  TEST: lag_atten: reduced lag still allows forward progress on curve (dist=0.903 v=0.302) [PASS]
  TEST: lag_atten: zero curvature → lag weight unchanged (no regression) [PASS]

[Closed-Loop Bicycle Dynamics]
  TEST: closed-loop: straight path → CTE < 0.06m (baseline)   (max_cte=0.0489 avg_cte=0.0072 prog=43.9%) [PASS]
  TEST: closed-loop: 90° curve r=1.0m → CTE < 0.35m          (max_cte=0.3422 avg_cte=0.0207 prog=100.0%) [PASS]
  TEST: closed-loop: 90° curve r=0.8m → CTE < 0.35m          (max_cte=0.5412 avg_cte=0.0609 prog=100.0%) [PASS]
  TEST: closed-loop: 90° curve r=0.6m → CTE < 0.40m          (max_cte=0.8658 avg_cte=0.2430 prog=100.0%) [PASS]
  TEST: closed-loop: S-curve r=1.2m alternating → CTE < 0.20m (max_cte=0.0242 avg_cte=0.0035 prog=86.2%) [PASS]
  TEST: closed-loop: 180° U-turn r=0.8m → CTE < 0.35m        (max_cte=0.0069 avg_cte=0.0025 prog=92.7%) [PASS]
  TEST: closed-loop: vehicle slows before tight curve           (v_straight=0.451 v_curve_min=0.274) [PASS]
  TEST: closed-loop: no backward motion or looping on tight curve (max_prog=499/500 loop=no) [PASS]

[Oscillation Detection]
  TEST: oscillation: straight path → ≤3 CTE sign changes in 50 steps (sign_changes=4) [PASS]
  TEST: oscillation: gentle curve r=2m → ≤4 CTE sign changes (sign_changes=2) [PASS]
  TEST: oscillation: 10cm offset → converge without overshoot (overshoot=0.0128m) [PASS]

[Reference MPCC.py Dynamics Validation]
  TEST: ref_dynamics: straight (δ=0) → dψ=0, dx=v           [PASS]
  TEST: ref_dynamics: yaw rate = v/L * tan(δ) * cos(β) (not sin(β)/L) [PASS]
  TEST: ref_dynamics: yaw rate correct for δ = ±10°, ±20°, ±30° [PASS]
  TEST: ref_dynamics: turn radius = L / tan(δ) at low speed    (R_meas=1.2694 R_acker=1.2629) [PASS]
  TEST: ref_contouring: e_c sign matches reference MPCC.py      [PASS]
  TEST: ref_solver: output v_cmd and delta_cmd are reasonable for straight path [PASS]
  TEST: ref_solver: left curve → positive steering, speed < v_ref [PASS]

[Deployment Simulation]
  TEST: deployment: roundabout (r=0.5m, 270°) → CTE < 0.25m  (max=0.0835 avg=0.0496 steps=123 prog=96.5%) [PASS]
  TEST: deployment: consecutive solves with warm-start → decreasing cost [PASS]
  TEST: deployment: v_cmd/delta_cmd pipeline → vehicle tracks path [PASS]

[Adaptive Path Re-projection]
  TEST: adaptive_reproj: tight curve (r=0.5m) with PathLookup → CTE < 0.20m (max=0.0869 avg=0.0471 steps=112 prog=96.5%) [PASS]
  TEST: adaptive_reproj: S-curve with PathLookup → CTE < 0.40m (max=0.0156 steps=63 prog=95.5%) [PASS]

=== Results: 73 passed, 0 failed ===
