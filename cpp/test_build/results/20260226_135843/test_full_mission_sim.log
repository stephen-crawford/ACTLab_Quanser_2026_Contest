=== Full Mission Closed-Loop Simulation ===

Running hub_to_pickup...
  hub_to_pickup: max_cte=0.014 avg_cte=0.003 steps=280 prog=99% heading_err_max=11.3deg steer_sat=0 completed=yes
Running pickup_to_dropoff...
    Hermite blend: heading_err=-89.9deg, blend_dist=2.50m, chord=2.29m
  pickup_to_dropoff: max_cte=0.012 avg_cte=0.004 steps=182 prog=98% heading_err_max=10.7deg steer_sat=0 completed=yes
Running dropoff_to_hub...
    Hermite blend: heading_err=95.3deg, blend_dist=2.50m, chord=2.17m
  dropoff_to_hub: max_cte=0.020 avg_cte=0.005 steps=427 prog=99% heading_err_max=13.0deg steer_sat=0 completed=yes
Blended path: blended_hub_to_pickup.csv (2103 points)
Blended path: blended_pickup_to_dropoff.csv (1229 points)
Blended path: blended_dropoff_to_hub.csv (2841 points)

CSV written: full_mission_sim.csv (889 data points)

=== Mission Summary ===
Duration: 90.8s
Max CTE:  0.020m
Avg CTE:  0.004m
Avg speed: 0.34 m/s
Points:   889

PASS: Max CTE 0.020m within 0.30m threshold


=== Full Mission with Traffic Events ===

Running hub_to_pickup (with traffic)...
    [hub_to_pickup] 2 traffic stops, creep=off, max_cte=0.014
  hub_to_pickup: max_cte=0.014 avg_cte=0.002 steps=372 prog=99% heading_err_max=11.3deg steer_sat=0 completed=yes
Running pickup_to_dropoff (with traffic)...
    Hermite blend: heading_err=-89.9deg, blend_dist=2.50m, chord=2.27m
    [pickup_to_dropoff] 0 traffic stops, creep=off, max_cte=0.014
  pickup_to_dropoff: max_cte=0.014 avg_cte=0.005 steps=196 prog=99% heading_err_max=10.8deg steer_sat=0 completed=yes
Running dropoff_to_hub (with traffic)...
    Hermite blend: heading_err=95.1deg, blend_dist=2.50m, chord=2.16m
    [dropoff_to_hub] 2 traffic stops, creep=off, max_cte=0.022
  dropoff_to_hub: max_cte=0.022 avg_cte=0.004 steps=572 prog=99% heading_err_max=13.0deg steer_sat=0 completed=yes

=== Traffic Mission Summary ===
Duration: 115.9s
Max CTE:  0.022m
Avg CTE:  0.004m
Points:   1140

PASS: Traffic test Max CTE 0.022m within 0.30m


=== Stress Test: Frequent Stops ===

    [stress_hub_to_pickup] 9 traffic stops, creep=off, max_cte=0.014
  Stress test: max_cte=0.014 avg_cte=0.003 steps=510 prog=99% completed=yes
PASS: Stress test Max CTE 0.014m within 0.30m


=== Sim-to-Real Gap Analysis ===

[Gap Test 4a] boundary_weight=8.0 (deployment had this, ref has 0)
    Hermite blend: heading_err=-89.9deg, blend_dist=2.50m, chord=2.29m
    Hermite blend: heading_err=95.4deg, blend_dist=2.50m, chord=2.17m
  boundary_weight=8.0: max_cte=0.020m (vs 0.067m without boundaries)

[Gap Test 4b] Velocity estimation lag (EKF ~100ms delay)
    Hermite blend: heading_err=-89.9deg, blend_dist=2.50m, chord=2.29m
    Hermite blend: heading_err=95.3deg, blend_dist=2.50m, chord=2.17m
  velocity_lag=100ms: max_cte=0.020m (vs 0.067m without lag)

[Gap Test 4c] boundary_weight=8.0 + velocity_lag=100ms (full deployment model)
    Hermite blend: heading_err=-89.9deg, blend_dist=2.50m, chord=2.29m
    Hermite blend: heading_err=95.4deg, blend_dist=2.50m, chord=2.17m
  boundary+lag combined: max_cte=0.020m (deployment saw 0.203m)

[Gap Test 4d] Position noise σ=10mm + heading noise σ=2° (SLAM jitter)
    Hermite blend: heading_err=-89.3deg, blend_dist=2.50m, chord=2.27m
    Hermite blend: heading_err=93.4deg, blend_dist=2.50m, chord=2.16m
  noise σ_pos=10mm σ_θ=2°: max_cte=0.020m avg_cte=0.005m

[Gap Test 4e] ALL: boundary=8.0 + vel_lag + noise σ=10mm/2°
    Hermite blend: heading_err=-89.3deg, blend_dist=2.50m, chord=2.28m
    Hermite blend: heading_err=93.4deg, blend_dist=2.50m, chord=2.16m
  ALL combined: max_cte=0.020m avg_cte=0.005m (deployment saw max=0.203 avg=0.090)

=== Gap analysis complete ===
Fix applied: boundary_weight=0, use_state_estimator=false

=== ALL TESTS PASSED ===
